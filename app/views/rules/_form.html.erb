<%= form_for rule, html: { class: 'docs docs-small span6' } do |f| %>
  <% if params[:redirect_path] %>
    <input type='hidden' name='redirect_path' value='<%= params[:redirect_path] %>' />
  <% end %>

  <!-- Matcher fieldset -->
  <div class='row-fluid'>
    <%= f.select :command,
                 Message::COMMANDS,
                 {},
                 { class: 'input-medium' } %>
  </div>
  <div class='row-fluid'>
    <%= f.text_field :arg, class: 'span12', placeholder: 'case-insensitive regex' %>
  </div>
  
  <!-- Setter fieldsets -->
  <div id='fieldsets'>
    <% if rule.new_record? %>
      <%= render 'fieldset', setter: rule %>
    <% else %>
      <% rule.setters.each do |setter| %>
        <%= render 'fieldset', setter: setter %>
      <% end %>
    <% end %>
  </div>
  
  <div class='row-fluid new-row'>
    <div class='actions offset1'>
      <a class='new' href='#'>
        <i class='icon-plus'></i>new setter
      </a>
    </div>
  </div>
  
  <%= render 'shared/form_errors', model: rule %>
  <!-- TODO rule validations -->
  
  <div class='row-fluid'>
    <%= f.submit class: 'btn btn-primary span12' %>
  </div>
  
  <div class='row-fluid'>
    <%= link_to 'Cancel', @redirect_path, class: 'cancel' %>
  </div>
<% end %>
  
<div id='fieldset-factory'>
  <%= render 'fieldset', setter: Rule.new %>
</div>
